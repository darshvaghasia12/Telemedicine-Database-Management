/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import * as agoraSDK from 'agora-rtc-sdk';
import * as i0 from "@angular/core";
/**
 * Provides access to the Agora web API, including the AgoraRTC and Client objects.
 */
export class NgxAgoraService {
    /**
     * @param {?} config
     */
    constructor(config) {
        this.config = config;
        /**
         * All audio devices collected from the AgoraRTC `getDevices()` method.
         * @see [getDevices()](https://docs.agora.io/en/Video/API%20Reference/web/globals.html#getdevices)
         *
         */
        this.audioDevices = [];
        /**
         * All video devices collected from the AgoraRTC `getDevices()` method.
         * @see [getDevices()](https://docs.agora.io/en/Video/API%20Reference/web/globals.html#getdevices)
         */
        this.videoDevices = [];
        /**
         * Instance reference to the `static` AgoraRTC library object.
         */
        this.AgoraRTC = NgxAgoraService.AgoraRTC;
        if (!this.checkSystemRequirements()) {
            this.AgoraRTC.Logger.error('Web RTC is not supported in this browser');
        }
        else {
            this.collectDevices();
        }
    }
    /**
     * Checks the Web Browser Compatibility
     *
     * This method checks the compatibility between the Web SDK and the current web browser.
     * Use this method before calling createClient to check the compatibility between the system and the web browser.
     *
     * - true: The Web SDK is compatible with the current web browser.
     * - false: The Web SDK is not compatible with the current web browser.
     *
     * \@remark
     * Agora has yet to conduct comprehensive tests on Chromium kernel browsers, such as QQ and 360.
     * Agora will gradually achieve compatibility on most mainstream browsers in subsequent versions of the Web SDK.
     * @return {?}
     */
    checkSystemRequirements() {
        return this.AgoraRTC.checkSystemRequirements();
    }
    /**
     * Creates a Client object.
     *
     * This method creates and returns a client object. You can only call this method once each call session.
     *
     * \@example
     * AgoraRTC.createClient(config);
     * @param {?} config
     * Defines the property of the client, see
     * [ClientConfig](https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.clientconfig.html) for details.
     * @param {?=} autoInitializing
     * @param {?=} onSuccess
     * @param {?=} onFailure
     * @return {?}
     */
    createClient(config, autoInitializing = true, onSuccess, onFailure) {
        this.client = this.AgoraRTC.createClient(config);
        if (autoInitializing) {
            this.init(this.config.AppID, onSuccess, onFailure);
        }
        return this.client;
    }
    /**
     * This method creates and returns a stream object.
     *
     * \@example
     * AgoraRTC.createStream(spec)
     *
     * @see [StreamSpec](https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.streamspec.html) for details.
     * @param {?} spec Defines the properties of the stream
     * @return {?}
     */
    createStream(spec) {
        if (!spec.microphoneId && this.audioDevices && this.audioDevices.length) {
            /** @type {?} */
            const defaultMic = this.audioDevices[0].deviceId;
            spec.microphoneId = defaultMic;
        }
        if (!spec.cameraId && this.videoDevices && this.videoDevices.length) {
            /** @type {?} */
            const defaultCamera = this.videoDevices[0].deviceId;
            spec.cameraId = spec.cameraId || defaultCamera;
        }
        return this.AgoraRTC.createStream(spec);
    }
    /**
     * Initializes the Client object.
     *
     * @see [Get an App ID](https://docs.agora.io/en/Video/web_prepare?platform=Web#create-an-agora-account-and-get-an-app-id).
     * \@example
     * this.ngxAgoraService.client.init(appId, () => {
     * console.log("client initialized");
     * // Join a channel
     * //……
     * }, error => {
     *     console.log("client init failed ", err);
     *     // Error handling
     * });
     * @param {?} appId Pass in the App ID for your project.
     * ASCII characters only, and the string length must be greater than 0 and less than 256 bytes.
     * To get your App ID,
     * @param {?=} onSuccess
     * @param {?=} onFailure
     * @return {?}
     */
    init(appId, onSuccess, onFailure) {
        this.client.init(appId, onSuccess, onFailure);
    }
    /**
     * Attempts to automatically collect audio and video devices from the AgoraRTC `getDevices()` method.
     * @private
     * @return {?}
     */
    collectDevices() {
        this.AgoraRTC.getDevices((/**
         * @param {?} devices
         * @return {?}
         */
        (devices) => {
            /** @type {?} */
            const audioDevices = devices.filter((/**
             * @param {?} device
             * @return {?}
             */
            device => {
                return device.kind === 'audioinput' && device.deviceId !== 'default';
            }));
            /** @type {?} */
            const videoDevices = devices.filter((/**
             * @param {?} device
             * @return {?}
             */
            device => {
                return device.kind === 'videoinput' && device.deviceId !== 'default';
            }));
            this.audioDevices = audioDevices;
            this.videoDevices = videoDevices;
        }));
    }
}
NgxAgoraService.AgoraRTC = agoraSDK;
NgxAgoraService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
NgxAgoraService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: ['config',] }] }
];
/** @nocollapse */ NgxAgoraService.ngInjectableDef = i0.defineInjectable({ factory: function NgxAgoraService_Factory() { return new NgxAgoraService(i0.inject("config")); }, token: NgxAgoraService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgxAgoraService.AgoraRTC;
    /**
     * The local Agora.io Client object.
     * @see [Web Client](https://docs.agora.io/en/Video/API%20Reference/web/interfaces/agorartc.client.html)
     * @type {?}
     */
    NgxAgoraService.prototype.client;
    /**
     * All audio devices collected from the AgoraRTC `getDevices()` method.
     * @see [getDevices()](https://docs.agora.io/en/Video/API%20Reference/web/globals.html#getdevices)
     *
     * @type {?}
     */
    NgxAgoraService.prototype.audioDevices;
    /**
     * All video devices collected from the AgoraRTC `getDevices()` method.
     * @see [getDevices()](https://docs.agora.io/en/Video/API%20Reference/web/globals.html#getdevices)
     * @type {?}
     */
    NgxAgoraService.prototype.videoDevices;
    /**
     * Instance reference to the `static` AgoraRTC library object.
     * @type {?}
     */
    NgxAgoraService.prototype.AgoraRTC;
    /**
     * @type {?}
     * @private
     */
    NgxAgoraService.prototype.config;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWFnb3JhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtYWdvcmEvIiwic291cmNlcyI6WyJsaWIvbmd4LWFnb3JhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sS0FBSyxRQUFRLE1BQU0sZUFBZSxDQUFDOzs7OztBQVkxQyxNQUFNLE9BQU8sZUFBZTs7OztJQXdCMUIsWUFBc0MsTUFBbUI7UUFBbkIsV0FBTSxHQUFOLE1BQU0sQ0FBYTs7Ozs7O1FBWHpELGlCQUFZLEdBQXNCLEVBQUUsQ0FBQzs7Ozs7UUFLckMsaUJBQVksR0FBc0IsRUFBRSxDQUFDOzs7O1FBSXJDLGFBQVEsR0FBYSxlQUFlLENBQUMsUUFBUSxDQUFDO1FBRzVDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsRUFBRTtZQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsMENBQTBDLENBQUMsQ0FBQztTQUN4RTthQUFNO1lBQ0wsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7O0lBZUQsdUJBQXVCO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO0lBQ2pELENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7SUFtQkQsWUFBWSxDQUNWLE1BQW9CLEVBQ3BCLG1CQUE0QixJQUFJLEVBQ2hDLFNBQXNCLEVBQ3RCLFNBQWtDO1FBRWxDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDakQsSUFBSSxnQkFBZ0IsRUFBRTtZQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztTQUNwRDtRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDOzs7Ozs7Ozs7OztJQVdELFlBQVksQ0FBQyxJQUFnQjtRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFOztrQkFDakUsVUFBVSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUTtZQUNoRCxJQUFJLENBQUMsWUFBWSxHQUFHLFVBQVUsQ0FBQztTQUNoQztRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUU7O2tCQUM3RCxhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRO1lBQ25ELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsSUFBSSxhQUFhLENBQUM7U0FDaEQ7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQXNCRCxJQUFJLENBQUMsS0FBYSxFQUFFLFNBQXNCLEVBQUUsU0FBa0M7UUFDNUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNoRCxDQUFDOzs7Ozs7SUFLTyxjQUFjO1FBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVTs7OztRQUFDLENBQUMsT0FBMEIsRUFBRSxFQUFFOztrQkFDaEQsWUFBWSxHQUFHLE9BQU8sQ0FBQyxNQUFNOzs7O1lBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzNDLE9BQU8sTUFBTSxDQUFDLElBQUksS0FBSyxZQUFZLElBQUksTUFBTSxDQUFDLFFBQVEsS0FBSyxTQUFTLENBQUM7WUFDdkUsQ0FBQyxFQUFDOztrQkFFSSxZQUFZLEdBQUcsT0FBTyxDQUFDLE1BQU07Ozs7WUFBQyxNQUFNLENBQUMsRUFBRTtnQkFDM0MsT0FBTyxNQUFNLENBQUMsSUFBSSxLQUFLLFlBQVksSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLFNBQVMsQ0FBQztZQUN2RSxDQUFDLEVBQUM7WUFFRixJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztZQUNqQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztRQUNuQyxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7O0FBNUljLHdCQUFRLEdBQWEsUUFBUSxDQUFDOztZQUo5QyxVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7Ozs7NENBeUJjLE1BQU0sU0FBQyxRQUFROzs7Ozs7OztJQXZCNUIseUJBQTZDOzs7Ozs7SUFNN0MsaUNBQW9COzs7Ozs7O0lBTXBCLHVDQUFxQzs7Ozs7O0lBS3JDLHVDQUFxQzs7Ozs7SUFJckMsbUNBQThDOzs7OztJQUVsQyxpQ0FBNkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIGFnb3JhU0RLIGZyb20gJ2Fnb3JhLXJ0Yy1zZGsnO1xuXG5pbXBvcnQgeyBBZ29yYUNsaWVudCB9IGZyb20gJy4vZGF0YS9tb2RlbHMvYWdvcmEtY2xpZW50Lm1vZGVsJztcbmltcG9ydCB7IEFnb3JhQ29uZmlnIH0gZnJvbSAnLi9kYXRhL21vZGVscy9hZ29yYS1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgQWdvcmFSVEMsIENsaWVudENvbmZpZywgTWVkaWFEZXZpY2VJbmZvLCBTdHJlYW0sIFN0cmVhbVNwZWMgfSBmcm9tICcuL2RhdGEvbW9kZWxzJztcblxuLyoqXG4gKiBQcm92aWRlcyBhY2Nlc3MgdG8gdGhlIEFnb3JhIHdlYiBBUEksIGluY2x1ZGluZyB0aGUgQWdvcmFSVEMgYW5kIENsaWVudCBvYmplY3RzLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hBZ29yYVNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBBZ29yYVJUQzogQWdvcmFSVEMgPSBhZ29yYVNESztcblxuICAvKipcbiAgICogVGhlIGxvY2FsIEFnb3JhLmlvIENsaWVudCBvYmplY3QuXG4gICAqIEBzZWUgW1dlYiBDbGllbnRdKGh0dHBzOi8vZG9jcy5hZ29yYS5pby9lbi9WaWRlby9BUEklMjBSZWZlcmVuY2Uvd2ViL2ludGVyZmFjZXMvYWdvcmFydGMuY2xpZW50Lmh0bWwpXG4gICAqL1xuICBjbGllbnQ6IEFnb3JhQ2xpZW50O1xuICAvKipcbiAgICogQWxsIGF1ZGlvIGRldmljZXMgY29sbGVjdGVkIGZyb20gdGhlIEFnb3JhUlRDIGBnZXREZXZpY2VzKClgIG1ldGhvZC5cbiAgICogQHNlZSBbZ2V0RGV2aWNlcygpXShodHRwczovL2RvY3MuYWdvcmEuaW8vZW4vVmlkZW8vQVBJJTIwUmVmZXJlbmNlL3dlYi9nbG9iYWxzLmh0bWwjZ2V0ZGV2aWNlcylcbiAgICpcbiAgICovXG4gIGF1ZGlvRGV2aWNlczogTWVkaWFEZXZpY2VJbmZvW10gPSBbXTtcbiAgLyoqXG4gICAqIEFsbCB2aWRlbyBkZXZpY2VzIGNvbGxlY3RlZCBmcm9tIHRoZSBBZ29yYVJUQyBgZ2V0RGV2aWNlcygpYCBtZXRob2QuXG4gICAqIEBzZWUgW2dldERldmljZXMoKV0oaHR0cHM6Ly9kb2NzLmFnb3JhLmlvL2VuL1ZpZGVvL0FQSSUyMFJlZmVyZW5jZS93ZWIvZ2xvYmFscy5odG1sI2dldGRldmljZXMpXG4gICAqL1xuICB2aWRlb0RldmljZXM6IE1lZGlhRGV2aWNlSW5mb1tdID0gW107XG4gIC8qKlxuICAgKiBJbnN0YW5jZSByZWZlcmVuY2UgdG8gdGhlIGBzdGF0aWNgIEFnb3JhUlRDIGxpYnJhcnkgb2JqZWN0LlxuICAgKi9cbiAgQWdvcmFSVEM6IEFnb3JhUlRDID0gTmd4QWdvcmFTZXJ2aWNlLkFnb3JhUlRDO1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoJ2NvbmZpZycpIHByaXZhdGUgY29uZmlnOiBBZ29yYUNvbmZpZykge1xuICAgIGlmICghdGhpcy5jaGVja1N5c3RlbVJlcXVpcmVtZW50cygpKSB7XG4gICAgICB0aGlzLkFnb3JhUlRDLkxvZ2dlci5lcnJvcignV2ViIFJUQyBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbGxlY3REZXZpY2VzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyB0aGUgV2ViIEJyb3dzZXIgQ29tcGF0aWJpbGl0eVxuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBjaGVja3MgdGhlIGNvbXBhdGliaWxpdHkgYmV0d2VlbiB0aGUgV2ViIFNESyBhbmQgdGhlIGN1cnJlbnQgd2ViIGJyb3dzZXIuXG4gICAqIFVzZSB0aGlzIG1ldGhvZCBiZWZvcmUgY2FsbGluZyBjcmVhdGVDbGllbnQgdG8gY2hlY2sgdGhlIGNvbXBhdGliaWxpdHkgYmV0d2VlbiB0aGUgc3lzdGVtIGFuZCB0aGUgd2ViIGJyb3dzZXIuXG4gICAqXG4gICAqIC0gdHJ1ZTogVGhlIFdlYiBTREsgaXMgY29tcGF0aWJsZSB3aXRoIHRoZSBjdXJyZW50IHdlYiBicm93c2VyLlxuICAgKiAtIGZhbHNlOiBUaGUgV2ViIFNESyBpcyBub3QgY29tcGF0aWJsZSB3aXRoIHRoZSBjdXJyZW50IHdlYiBicm93c2VyLlxuICAgKlxuICAgKiBAcmVtYXJrXG4gICAqIEFnb3JhIGhhcyB5ZXQgdG8gY29uZHVjdCBjb21wcmVoZW5zaXZlIHRlc3RzIG9uIENocm9taXVtIGtlcm5lbCBicm93c2Vycywgc3VjaCBhcyBRUSBhbmQgMzYwLlxuICAgKiBBZ29yYSB3aWxsIGdyYWR1YWxseSBhY2hpZXZlIGNvbXBhdGliaWxpdHkgb24gbW9zdCBtYWluc3RyZWFtIGJyb3dzZXJzIGluIHN1YnNlcXVlbnQgdmVyc2lvbnMgb2YgdGhlIFdlYiBTREsuXG4gICAqL1xuICBjaGVja1N5c3RlbVJlcXVpcmVtZW50cygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5BZ29yYVJUQy5jaGVja1N5c3RlbVJlcXVpcmVtZW50cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBDbGllbnQgb2JqZWN0LlxuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBjcmVhdGVzIGFuZCByZXR1cm5zIGEgY2xpZW50IG9iamVjdC4gWW91IGNhbiBvbmx5IGNhbGwgdGhpcyBtZXRob2Qgb25jZSBlYWNoIGNhbGwgc2Vzc2lvbi5cbiAgICpcbiAgICogQHBhcmFtIGNvbmZpZ1xuICAgKiBEZWZpbmVzIHRoZSBwcm9wZXJ0eSBvZiB0aGUgY2xpZW50LCBzZWVcbiAgICogW0NsaWVudENvbmZpZ10oaHR0cHM6Ly9kb2NzLmFnb3JhLmlvL2VuL1ZpZGVvL0FQSSUyMFJlZmVyZW5jZS93ZWIvaW50ZXJmYWNlcy9hZ29yYXJ0Yy5jbGllbnRjb25maWcuaHRtbCkgZm9yIGRldGFpbHMuXG4gICAqIEBwYXJhbSBbYXV0b0luaXRpYWxpemluZz10cnVlXSBOZ3gtYWdvcmEgYnkgZGVmYXVsdCBhdXRvbWF0aWNhbGx5IGluaXRpYWxpemVzIHRoZSBjbGllbnQgd2l0aCB0aGUgcHJvdmlkZWQgYEFwcElEYCBhZnRlciBpdCBpcyBjcmVhdGVkLlxuICAgKiBTZXQgdGhpcyBwcm9wZXJ0eSB0byBgZmFsc2VgIHRvIGRpc2FibGUgdGhpcyBmdW5jdGlvbmFsaXR5LCBpZiB5b3UgYXJlIGdvaW5nIHRvIGNhbGwgYGluaXQoKWAgc2VwYXJhdGVseVxuICAgKiAoYWZ0ZXIgY3JlYXRpbmcgdGhlIGNsaWVudCBvbmx5KS5cbiAgICogQHBhcmFtIFtvblN1Y2Nlc3NdIFRoZSBjYWxsYmFjayB3aGVuIHRoZSBtZXRob2Qgc3VjY2VlZHMuXG4gICAqIEBwYXJhbSBbb25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgd2hlbiB0aGUgbWV0aG9kIGZhaWxzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBBZ29yYVJUQy5jcmVhdGVDbGllbnQoY29uZmlnKTtcbiAgICovXG4gIGNyZWF0ZUNsaWVudChcbiAgICBjb25maWc6IENsaWVudENvbmZpZyxcbiAgICBhdXRvSW5pdGlhbGl6aW5nOiBib29sZWFuID0gdHJ1ZSxcbiAgICBvblN1Y2Nlc3M/OiAoKSA9PiB2b2lkLFxuICAgIG9uRmFpbHVyZT86IChlcnJvcjogRXJyb3IpID0+IHZvaWRcbiAgKTogQWdvcmFDbGllbnQge1xuICAgIHRoaXMuY2xpZW50ID0gdGhpcy5BZ29yYVJUQy5jcmVhdGVDbGllbnQoY29uZmlnKTtcbiAgICBpZiAoYXV0b0luaXRpYWxpemluZykge1xuICAgICAgdGhpcy5pbml0KHRoaXMuY29uZmlnLkFwcElELCBvblN1Y2Nlc3MsIG9uRmFpbHVyZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNsaWVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCBjcmVhdGVzIGFuZCByZXR1cm5zIGEgc3RyZWFtIG9iamVjdC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogQWdvcmFSVEMuY3JlYXRlU3RyZWFtKHNwZWMpXG4gICAqXG4gICAqIEBwYXJhbSBzcGVjIERlZmluZXMgdGhlIHByb3BlcnRpZXMgb2YgdGhlIHN0cmVhbVxuICAgKiBAc2VlIFtTdHJlYW1TcGVjXShodHRwczovL2RvY3MuYWdvcmEuaW8vZW4vVmlkZW8vQVBJJTIwUmVmZXJlbmNlL3dlYi9pbnRlcmZhY2VzL2Fnb3JhcnRjLnN0cmVhbXNwZWMuaHRtbCkgZm9yIGRldGFpbHMuXG4gICAqL1xuICBjcmVhdGVTdHJlYW0oc3BlYzogU3RyZWFtU3BlYyk6IFN0cmVhbSB7XG4gICAgaWYgKCFzcGVjLm1pY3JvcGhvbmVJZCAmJiB0aGlzLmF1ZGlvRGV2aWNlcyAmJiB0aGlzLmF1ZGlvRGV2aWNlcy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRNaWMgPSB0aGlzLmF1ZGlvRGV2aWNlc1swXS5kZXZpY2VJZDtcbiAgICAgIHNwZWMubWljcm9waG9uZUlkID0gZGVmYXVsdE1pYztcbiAgICB9XG4gICAgaWYgKCFzcGVjLmNhbWVyYUlkICYmIHRoaXMudmlkZW9EZXZpY2VzICYmIHRoaXMudmlkZW9EZXZpY2VzLmxlbmd0aCkge1xuICAgICAgY29uc3QgZGVmYXVsdENhbWVyYSA9IHRoaXMudmlkZW9EZXZpY2VzWzBdLmRldmljZUlkO1xuICAgICAgc3BlYy5jYW1lcmFJZCA9IHNwZWMuY2FtZXJhSWQgfHwgZGVmYXVsdENhbWVyYTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5BZ29yYVJUQy5jcmVhdGVTdHJlYW0oc3BlYyk7XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIENsaWVudCBvYmplY3QuXG4gICAqXG4gICAqIEBwYXJhbSBhcHBJZCBQYXNzIGluIHRoZSBBcHAgSUQgZm9yIHlvdXIgcHJvamVjdC5cbiAgICogQVNDSUkgY2hhcmFjdGVycyBvbmx5LCBhbmQgdGhlIHN0cmluZyBsZW5ndGggbXVzdCBiZSBncmVhdGVyIHRoYW4gMCBhbmQgbGVzcyB0aGFuIDI1NiBieXRlcy5cbiAgICogVG8gZ2V0IHlvdXIgQXBwIElELFxuICAgKiBAc2VlIFtHZXQgYW4gQXBwIElEXShodHRwczovL2RvY3MuYWdvcmEuaW8vZW4vVmlkZW8vd2ViX3ByZXBhcmU/cGxhdGZvcm09V2ViI2NyZWF0ZS1hbi1hZ29yYS1hY2NvdW50LWFuZC1nZXQtYW4tYXBwLWlkKS5cbiAgICogQHBhcmFtIFtvblN1Y2Nlc3NdIFRoZSBjYWxsYmFjayB3aGVuIHRoZSBtZXRob2Qgc3VjY2VlZHMuXG4gICAqIEBwYXJhbSBbb25GYWlsdXJlXSBUaGUgY2FsbGJhY2sgd2hlbiB0aGUgbWV0aG9kIGZhaWxzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiB0aGlzLm5neEFnb3JhU2VydmljZS5jbGllbnQuaW5pdChhcHBJZCwgKCkgPT4ge1xuICAgKiBjb25zb2xlLmxvZyhcImNsaWVudCBpbml0aWFsaXplZFwiKTtcbiAgICogLy8gSm9pbiBhIGNoYW5uZWxcbiAgICogLy/igKbigKZcbiAgICogfSwgZXJyb3IgPT4ge1xuICAgKiAgICAgY29uc29sZS5sb2coXCJjbGllbnQgaW5pdCBmYWlsZWQgXCIsIGVycik7XG4gICAqICAgICAvLyBFcnJvciBoYW5kbGluZ1xuICAgKiB9KTtcbiAgICovXG4gIGluaXQoYXBwSWQ6IHN0cmluZywgb25TdWNjZXNzPzogKCkgPT4gdm9pZCwgb25GYWlsdXJlPzogKGVycm9yOiBFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRoaXMuY2xpZW50LmluaXQoYXBwSWQsIG9uU3VjY2Vzcywgb25GYWlsdXJlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdHRlbXB0cyB0byBhdXRvbWF0aWNhbGx5IGNvbGxlY3QgYXVkaW8gYW5kIHZpZGVvIGRldmljZXMgZnJvbSB0aGUgQWdvcmFSVEMgYGdldERldmljZXMoKWAgbWV0aG9kLlxuICAgKi9cbiAgcHJpdmF0ZSBjb2xsZWN0RGV2aWNlcygpOiB2b2lkIHtcbiAgICB0aGlzLkFnb3JhUlRDLmdldERldmljZXMoKGRldmljZXM6IE1lZGlhRGV2aWNlSW5mb1tdKSA9PiB7XG4gICAgICBjb25zdCBhdWRpb0RldmljZXMgPSBkZXZpY2VzLmZpbHRlcihkZXZpY2UgPT4ge1xuICAgICAgICByZXR1cm4gZGV2aWNlLmtpbmQgPT09ICdhdWRpb2lucHV0JyAmJiBkZXZpY2UuZGV2aWNlSWQgIT09ICdkZWZhdWx0JztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2aWRlb0RldmljZXMgPSBkZXZpY2VzLmZpbHRlcihkZXZpY2UgPT4ge1xuICAgICAgICByZXR1cm4gZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0JyAmJiBkZXZpY2UuZGV2aWNlSWQgIT09ICdkZWZhdWx0JztcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmF1ZGlvRGV2aWNlcyA9IGF1ZGlvRGV2aWNlcztcbiAgICAgIHRoaXMudmlkZW9EZXZpY2VzID0gdmlkZW9EZXZpY2VzO1xuICAgIH0pO1xuICB9XG59XG4iXX0=